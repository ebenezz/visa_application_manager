<div class="p-4">
  <h2 class="mat-headline mb-4">Visa Applications</h2>

  <div *ngIf="loading" class="flex justify-center items-center h-32">
    <mat-spinner></mat-spinner>
  </div>

  <!-- Application Table -->
  <table mat-table [dataSource]="applications" class="mat-elevation-z8" *ngIf="!loading && applications.length">

    <!-- Applicant Name -->
    <ng-container matColumnDef="applicantName">
      <th mat-header-cell *matHeaderCellDef>Name</th>
      <td mat-cell *matCellDef="let app">{{ app.applicantName }}</td>
    </ng-container>

    <!-- Passport -->
    <ng-container matColumnDef="passportNumber">
      <th mat-header-cell *matHeaderCellDef>Passport</th>
      <td mat-cell *matCellDef="let app">{{ app.passportNumber }}</td>
    </ng-container>

    <!-- Country -->
    <ng-container matColumnDef="country">
      <th mat-header-cell *matHeaderCellDef>Country</th>
      <td mat-cell *matCellDef="let app">{{ getCountryName(app.countryId) }}</td>
    </ng-container>

    <!-- Status -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Status</th>
      <td mat-cell *matCellDef="let app">{{ app.status }}</td>
    </ng-container>

    <!-- Paid -->
    <ng-container matColumnDef="isPaid">
      <th mat-header-cell *matHeaderCellDef>Paid</th>
      <td mat-cell *matCellDef="let app">{{ app.isPaid ? 'Yes' : 'No' }}</td>
    </ng-container>

    <!-- Created -->
    <ng-container matColumnDef="createdAt">
      <th mat-header-cell *matHeaderCellDef>Created</th>
      <td mat-cell *matCellDef="let app">{{ app.createdAt | date:'short' }}</td>
    </ng-container>

    <!-- Actions -->
    <ng-container matColumnDef="actions">
      <th mat-header-cell *matHeaderCellDef>Actions</th>
      <td mat-cell *matCellDef="let app">
        <button mat-button color="primary" (click)="viewDetails(app.id)">View</button>
      </td>
    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
  </table>

  <!-- Inline Add Form -->
<mat-card class="application-form-card">
  <h2>Add New Application</h2>

  <form (ngSubmit)="addApplication()" #applicationForm="ngForm">
    <!-- Applicant Name -->
    <mat-form-field appearance="fill">
      <mat-label>Applicant Name</mat-label>
      <input matInput [(ngModel)]="form.applicantName" name="applicantName" required #name="ngModel">
      <mat-error *ngIf="name.invalid && name.touched">Name is required.</mat-error>
    </mat-form-field>

    <!-- Passport Number -->
    <mat-form-field appearance="fill">
      <mat-label>Passport Number</mat-label>
      <input matInput [(ngModel)]="form.passportNumber" name="passportNumber" required #passport="ngModel">
      <mat-error *ngIf="passport.invalid && passport.touched">Passport number is required.</mat-error>
    </mat-form-field>

    <!-- Email -->
    <mat-form-field appearance="fill">
      <mat-label>Email</mat-label>
      <input matInput type="email" [(ngModel)]="form.email" name="email" required #email="ngModel">
      <mat-error *ngIf="email.invalid && email.touched">Valid email is required.</mat-error>
    </mat-form-field>

    <!-- Phone Number -->
    <mat-form-field appearance="fill">
      <mat-label>Phone Number</mat-label>
      <input matInput [(ngModel)]="form.phoneNumber" name="phoneNumber" required #phone="ngModel">
      <mat-error *ngIf="phone.invalid && phone.touched">Phone number is required.</mat-error>
    </mat-form-field>

    <!-- Country -->
    <mat-form-field appearance="fill">
      <mat-label>Country</mat-label>
      <mat-select [(ngModel)]="form.countryId" name="countryId" required #country="ngModel">
        <mat-option *ngFor="let c of countries" [value]="c.id">{{ c.name }}</mat-option>
      </mat-select>
      <mat-error *ngIf="country.invalid && country.touched">Country is required.</mat-error>
    </mat-form-field>

    <!-- Status -->
    <mat-form-field appearance="fill">
      <mat-label>Status</mat-label>
      <mat-select [(ngModel)]="form.status" name="status" required #status="ngModel">
        <mat-option value="Pending">Pending</mat-option>
        <mat-option value="Approved">Approved</mat-option>
        <mat-option value="Rejected">Rejected</mat-option>
      </mat-select>
      <mat-error *ngIf="status.invalid && status.touched">Status is required.</mat-error>
    </mat-form-field>

    <!-- Paid Checkbox -->
    <mat-checkbox [(ngModel)]="form.isPaid" name="isPaid">Paid</mat-checkbox>

    <!-- Buttons -->
    <div class="form-actions">
      <button mat-raised-button color="primary" type="submit" [disabled]="applicationForm.invalid">Add</button>
      <button mat-button type="button" (click)="resetForm(applicationForm)">Cancel</button>
    </div>
  </form>
</mat-card>
</div>